<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta content name=keywords><meta content="Mostafa Abdelrahman" name=author><meta property="og:title" content="Page Rank Algorithm - Beyond Lambda"><meta property="og:url" content="https://mostafaeissa.github.io/post/page-rank/"><meta property="og:description" content><meta property="og:type" content="website"><title>Page Rank Algorithm | Beyond Lambda</title>
<link rel=stylesheet href=https://mostafaeissa.github.io//css/style.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css><script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script></head><body><section class=section><div class=container><nav class=nav><img src=/android-chrome-512x512.png alt=Avatar style=margin-right:1em height=100px><div class=nav-left style=flex-basis:auto><a class=nav-item href=https://mostafaeissa.github.io/><h1 class="title is-4">Beyond Lambda</h1></a><nav class="nav-item level is-mobile"><a class=level-item href=/tags>tags
</a><a class=level-item href=https://mostafaeissa.github.io/about/>about</a></nav></div><div class=nav-right><nav class="nav-item level is-mobile"><a class=level-item href=https://github.com/MostafaEissa target=_blank><span class=icon><i class="fa fa-github"></i>
</span></a><a class=level-item href=https://linkedin.com/in/mostafa-abdelrahman-16356b12a target=_blank><span class=icon><i class="fa fa-linkedin-square"></i>
</span></a><a class=level-item href=https://mostafaeissa.github.io/index.xml target=_blank><span class=icon><i class="fa fa-rss"></i></span></a></nav></div></nav></div></section><section class=section><div class=container><h1 class=title>Page Rank Algorithm</h1><h2 class="subtitle is-5">April 14, 2020 by Mostafa Abdelrahman</h2><div class=tags><a class="button is-link" href=https://mostafaeissa.github.io/tags/machine-learning>Machine Learning</a></div><div class=content><p>PageRank is an algorithm used to rank web pages in search engines results. It was named after, one of the founders of Google, Larry Page.</p><h3 id=introduction>Introduction</h3><p>PageRank is an algorithm used to rank web pages that relies on two ideas:</p><ol><li>counting the number of in-links a page has where the more in-links the higher the rank.</li><li>In-links from pages having a high rank should be worth more than in-links from pages having a low rank.</li></ol><p>This definition seems recursive because if a page A is linked to by three other pages B,C,D then in order to determine the PageRank of page A we need to also know the PageRank of B,C,D. As such, each page distributes its PageRank score equally on its out-links, the more out-links a page has, the less the share of each link. In our earlier example, the PageRank $PR(A) = \frac{PR(B)}{L(B)}+\frac{PR(C)}{L(C)}+\frac{PR(D)}{L(D)}$ where $L(x)$ is the number of out links from page $x$.</p><p>More generally, we can express page rank as :</p><p>$$PR(p) = \sum \limits_{q \in In(p)} \frac{PR(q)}{L(q)}$$</p><p>where $In(p)$ is the set of in-links to page $p$.</p><p>We can think of the problem as a surfer who follows the links randomly from a given page. However, the problem with this definition is that some pages do not have any out-links (a sink page) which can make our algorithm get stuck and that is why we need a better model.</p><h3 id=the-random-surfer-model>The Random Surfer Model</h3><p>Similar to how most people surf the web, on a given web page you choose to follow one of the links on the links on the page. If you reach a page without any links (a sink page) then you simply randomly restart on a new page on the web Furthermore, every once in a while, you get bored of following the link and you decide to jump to a totally new page.</p><p>In mathematical notation, let $c$ be the probability that the surfer will continue following the links while $(1-c)$ is the probability that the surfer will get bored and jump to a random page. A good value for $c = 0.85.$ This time PageRank score is a combination of the contribution of PageRank scores of the in-links and the contribution of randomly landing on this page when the surfer is bored.</p><p>$$
\begin{equation}
\label{page rank}
PR(p) = c \times \sum \limits_{q \in In(p)} \frac{PR(q)}{L(q)} + (1-c) \times \frac{1}{N}
\end{equation}
$$</p><p>We can think of the PageRank score $PR(p)$ of a page $p$ as the probability that a random surfer will be at page $p$ at a given point in time. In this interpretation, the PageRank score will be between 0 and 1 and since the surfer has to be on some page at any given time and the sum of the PageRank scores of all the pages sums to 1.</p><p>The Algorithm is as follows:</p><ol><li>Assign each node an initial page rank</li><li>repeat until convergence: calculate the page rank of each node using equation $\eqref{page rank}$</li></ol><h3 id=worked-example>Worked Example</h3><p>Consider <a href=https://www.cs.princeton.edu/~chazelle/courses/BIB/pagerank.htm>this example</a>, where we have four web pages pointing to each other as shown in the figure below. Intuitively, Page C has 3 in-links so it should have the highest PageRank and page D should be last because it does not have any in-links.</p><p><img src=/images/page-rank/example.png alt="page rank example"></p><p>We can write the PageRank score of each page as follows:</p><p>$$
\begin{aligned}
PR(A) &= c \times \frac{PR(C)}{1} +\frac{(1-c)}{4} \newline
PR(B) &= c \times \frac{PR(A)}{3} + \frac{(1-c)}{4} \newline
PR(C) &= c \times \left(\frac{PR(A)}{3} + \frac{PR(B)}{1} + \frac{PR(D)}{1} \right) + \frac{(1-c)}{4} \newline
PR(D) &= c \times \frac{PR(A)}{3} + \frac{(1-c)}{4} \newline
\end{aligned}
$$</p><h3 id=matrix-representation>Matrix Representation</h3><p>To make solving the above equations easier we can write them in matrix format. We will not go into all the mathematical details but we can write the equation as the sum of two matrices, the first matrix is very similar to the adjacency matrix of the original graph while the second matrix is just a constant matrix.</p><p>$$\begin{bmatrix} PR(A) & PR(B) & PR(C) & PR(D) \end{bmatrix} = \left(c \times \begin{bmatrix} 0 & 0.5 & 0 & 0 \newline 0 & 0 & 1 & 0 \newline 1 & 0 & 0 & 0 \newline 0 & 1 & 0 & 0 \end{bmatrix} + \frac{(1-c)}{4} \times \begin{bmatrix} 1 & 1 & 1 & 1 \newline 1 & 1 & 1 & 1 \newline 1 & 1 & 1 & 1 \newline 1 & 1 & 1 & 1 \end{bmatrix} \right) $$</p><p>We can then use <a href=https://en.wikipedia.org/wiki/Power_iteration>Power Iteration method</a> to solve this problem Let $c = 0.85$ and suppose we initialize</p><p>$$ \begin{bmatrix} PR(A) & PR(B) & PR(C) & PR(D) \end{bmatrix} = \begin{bmatrix} 1.0 & 0 & 0 & 0 \end{bmatrix} $$</p><table><thead><tr><th style=text-align:center>Page</th><th style=text-align:center>Iteration 1</th><th style=text-align:center>Iteration 2</th><th style=text-align:center>Iteration 3</th><th style=text-align:center>Iteration 4</th><th style=text-align:center>â€¦</th><th style=text-align:center>Iteration 12</th></tr></thead><tbody><tr><td style=text-align:center>Page A</td><td style=text-align:center>1.0</td><td style=text-align:center>0.0375</td><td style=text-align:center>0.4306250</td><td style=text-align:center>0.41707812</td><td style=text-align:center></td><td style=text-align:center>0.36124157</td></tr><tr><td style=text-align:center>Page B</td><td style=text-align:center>0.0</td><td style=text-align:center>0.4625</td><td style=text-align:center>0.0853125</td><td style=text-align:center>0.25239062</td><td style=text-align:center></td><td style=text-align:center>0.22300072</td></tr><tr><td style=text-align:center>Page C</td><td style=text-align:center>0.0</td><td style=text-align:center>0.4625</td><td style=text-align:center>0.4465625</td><td style=text-align:center>0.29303125</td><td style=text-align:center></td><td style=text-align:center>0.37825770</td></tr><tr><td style=text-align:center>Page D</td><td style=text-align:center>0.0</td><td style=text-align:center>0.0375</td><td style=text-align:center>0.0375000</td><td style=text-align:center>0.03750000</td><td style=text-align:center></td><td style=text-align:center>0.03750000</td></tr></tbody></table><h3 id=python-implementation>Python Implementation</h3><p>We can easily implement the iterations of power method in a couple of lines of python.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>page_rank</span>(adj_matrix):
</span></span><span style=display:flex><span>    <span style=color:#75715e># parameters</span>
</span></span><span style=display:flex><span>    num_pages <span style=color:#f92672>=</span> adj_matrix<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.85</span>
</span></span><span style=display:flex><span>    uniform_prob <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span><span style=color:#f92672>/</span>num_pages
</span></span><span style=display:flex><span>    epsilon <span style=color:#f92672>=</span> <span style=color:#ae81ff>1e-5</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># transition probability</span>
</span></span><span style=display:flex><span>    transition_matrix <span style=color:#f92672>=</span> c <span style=color:#f92672>*</span> adj_matrix  <span style=color:#f92672>+</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>c) <span style=color:#f92672>*</span> np<span style=color:#f92672>.</span>full((num_pages, num_pages), uniform_prob)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># initialize page rank</span>
</span></span><span style=display:flex><span>    pr <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>full((<span style=color:#ae81ff>1</span>, num_pages), uniform_prob)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    pr_new <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>matmul(pr, transition_matrix)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> np<span style=color:#f92672>.</span>sum((pr_new <span style=color:#f92672>-</span> pr)<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>&gt;</span> epsilon:
</span></span><span style=display:flex><span>        pr <span style=color:#f92672>=</span> pr_new
</span></span><span style=display:flex><span>        pr_new <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>matmul(pr, transition_matrix)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pr
</span></span></code></pre></div><h3 id=conclusion>Conclusion</h3><p>In this post, we described the PageRank algorithm. We then described the random surfer model and the interpreting PageRank as a probability. Later we described the algorithm steps and discussed how to use power iteration to solve the recursive equations.</p></div></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body>