<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta content name=keywords><meta content="Mostafa Abdelrahman" name=author><meta property="og:title" content="2048 - Beyond Lambda"><meta property="og:url" content="https://mostafaeissa.github.io/post/the-game-2048/"><meta property="og:description" content><meta property="og:type" content="website"><title>2048 | Beyond Lambda</title>
<link rel=stylesheet href=https://mostafaeissa.github.io//css/style.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css><script type=text/javascript>window.MathJax={tex:{}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script></head><body><section class=section><div class=container><nav class=nav><img src=/android-chrome-512x512.png alt=Avatar style=margin-right:1em height=100px><div class=nav-left style=flex-basis:auto><a class=nav-item href=https://mostafaeissa.github.io/><h1 class="title is-4">Beyond Lambda</h1></a><nav class="nav-item level is-mobile"><a class=level-item href=/tags>tags
</a><a class=level-item href=https://mostafaeissa.github.io/about/>about</a></nav></div><div class=nav-right><nav class="nav-item level is-mobile"><a class=level-item href=https://github.com/MostafaEissa target=_blank><span class=icon><i class="fa fa-github"></i>
</span></a><a class=level-item href=https://linkedin.com/in/mostafa-abdelrahman-16356b12a target=_blank><span class=icon><i class="fa fa-linkedin-square"></i>
</span></a><a class=level-item href=https://mostafaeissa.github.io/index.xml target=_blank><span class=icon><i class="fa fa-rss"></i></span></a></nav></div></nav></div></section><section class=section><div class=container><h1 class=title>2048</h1><h2 class="subtitle is-5">May 13, 2020 by Mostafa Abdelrahman</h2><div class=tags><a class="button is-link" href=https://mostafaeissa.github.io/tags/programming>Programming</a></div><div class=content><p>In this post we will try to implement the game 2048 as a console app in python!</p><h3 id=introduction>Introduction</h3><p>If you are not familiar with the <a href=https://en.wikipedia.org/wiki/2048_(video_game)>game 2048</a>. It is a sliding block puzzle game where you slide numbered tiles to combine them into a tile with the number 2048. You can checkout an online version <a href=https://play2048.co/>here</a> from the original creator.</p><h3 id=game-rules>Game Rules</h3><p>In order to implement the game we need to understand its rules. The game has only a few rules:</p><ol><li><p>At every turn, a tile randomly appears on the board with a value of 2 or 4.</p></li><li><p>The player can move the tiles in one of the four direction {left, right, up, down}</p><ul><li>tiles slides as far as possible in the played direction until stopped by another tile or the board edge</li><li>when two tiles with the same number collide together, they are merged ino a new title whose value is twice the value of the individual tile</li><li>a merged tile cannot merge with another tile in the same move.</li></ul></li></ol><h3 id=game-state>Game State</h3><p>We can represent the game as a 2D array which each cell position is either empty or contains a value that is a multiple of 2.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_board</span>():
</span></span><span style=display:flex><span>    board <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>],
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>],
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>],
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>,<span style=color:#66d9ef>None</span>]
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> board
</span></span></code></pre></div><p>We also need an additional function that will pick and empty cell and put a value of 2 or 4 into it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fill_random_cell</span>(board):
</span></span><span style=display:flex><span>    empty_slots <span style=color:#f92672>=</span> [(i,j) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(board<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>]) <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(board<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>if</span> board[i,j] <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>]
</span></span><span style=display:flex><span>    idx <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>randint(len(empty_slots))
</span></span><span style=display:flex><span>    value <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>choice([<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>4</span>])
</span></span><span style=display:flex><span>    board[empty_slots[idx]] <span style=color:#f92672>=</span> value
</span></span></code></pre></div><p>As such, in order to initialize the board we simply create an empty board and fill a random position on it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>new_game</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># create a random empty board</span>
</span></span><span style=display:flex><span>    board <span style=color:#f92672>=</span> create_board()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># fill an empty position with 2 or 4</span>
</span></span><span style=display:flex><span>    fill_random_cell(board)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> board
</span></span></code></pre></div><h3 id=merging-of-tiles>Merging of Tiles</h3><p>We need a couple of helper functions that can help us maage the game state.</p><p>First, we need a function to move the tiles in a certain direction by applying the rules specified below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>shift_left</span>(board):
</span></span><span style=display:flex><span>    width, height <span style=color:#f92672>=</span> board<span style=color:#f92672>.</span>shape
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(height):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> range(width):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, width):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> board[i][j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                    board[i][j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> board[i][j]
</span></span><span style=display:flex><span>                    board[i][j] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>merge_tiles</span>(board):
</span></span><span style=display:flex><span>    width, height <span style=color:#f92672>=</span> board<span style=color:#f92672>.</span>shape
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(height):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, width):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> board[i][j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> board[i][j] <span style=color:#f92672>and</span> board[i][j] <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                board[i][j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>*=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>                board[i][j] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span></code></pre></div><p>we can use the above functions to generalize board movement in all directions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>move</span>(board, direction):
</span></span><span style=display:flex><span>    new_board <span style=color:#f92672>=</span> board<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>    directions <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;left&#39;</span>: <span style=color:#66d9ef>lambda</span> x: x,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;right&#39;</span>: <span style=color:#66d9ef>lambda</span> board: np<span style=color:#f92672>.</span>flip(board),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;up&#39;</span> : <span style=color:#66d9ef>lambda</span> board: board<span style=color:#f92672>.</span>T,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;down&#39;</span>:<span style=color:#66d9ef>lambda</span> board: np<span style=color:#f92672>.</span>flip(board)<span style=color:#f92672>.</span>T
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    transform <span style=color:#f92672>=</span> directions[direction]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    new_board <span style=color:#f92672>=</span> transform(new_board)
</span></span><span style=display:flex><span>    shift_left(new_board)
</span></span><span style=display:flex><span>    merge_tiles(new_board)
</span></span><span style=display:flex><span>    shift_left(new_board)
</span></span><span style=display:flex><span>    new_board <span style=color:#f92672>=</span> transform(new_board)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> new_board
</span></span></code></pre></div><h3 id=end-of-game>End of Game</h3><p>Second, we need a function to determine if we reached the end of a game i.e. if a player has won if a tile has the value <code>1024</code> or lost if there are no more available moves left.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_game_won</span>(board):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (board <span style=color:#f92672>==</span> <span style=color:#ae81ff>1024</span>)<span style=color:#f92672>.</span>any()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_game_lost</span>(board):
</span></span><span style=display:flex><span>    <span style=color:#75715e># check all move direction</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># if no new board can be generated</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># then the game is lost</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (move(board, <span style=color:#e6db74>&#39;left&#39;</span>) <span style=color:#f92672>==</span> board)<span style=color:#f92672>.</span>all() \
</span></span><span style=display:flex><span>    <span style=color:#f92672>and</span> (move(board, <span style=color:#e6db74>&#39;right&#39;</span>) <span style=color:#f92672>==</span> board)<span style=color:#f92672>.</span>all() \
</span></span><span style=display:flex><span>    <span style=color:#f92672>and</span> (move(board, <span style=color:#e6db74>&#39;up&#39;</span>) <span style=color:#f92672>==</span> board)<span style=color:#f92672>.</span>all() \
</span></span><span style=display:flex><span>    <span style=color:#f92672>and</span> (move(board, <span style=color:#e6db74>&#39;down&#39;</span>) <span style=color:#f92672>==</span> board)<span style=color:#f92672>.</span>all() :
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span></code></pre></div><h3 id=game-loop>Game Loop</h3><p>What is left is some function to draw the board to the screen and correctly handle user input. Drawing can be done by a simple two nested for loops but we must be careful because cells can be blank or contain values up to 1024 so we need to make sure they all get maximum possible width needed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>draw</span>(board):
</span></span><span style=display:flex><span>    width, height <span style=color:#f92672>=</span> board<span style=color:#f92672>.</span>shape
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(height):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(width):
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;    &#39;</span> <span style=color:#66d9ef>if</span> board[i,j] <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#66d9ef>else</span> str(board[i,j])<span style=color:#f92672>.</span>center(<span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>            print(value,  end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;|&#39;</span>)
</span></span><span style=display:flex><span>        print()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;----|----|----|----&#39;</span>)
</span></span></code></pre></div><p>We will also need to read and parse user input. To make things simply we will assume users will not enter wrong input so that we do not have to handle input validation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user_input</span>():
</span></span><span style=display:flex><span>    inp <span style=color:#f92672>=</span> input()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> inp <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;w&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;up&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> inp <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;s&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;down&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> inp <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;a&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;left&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> inp <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;d&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;right&#39;</span>
</span></span></code></pre></div><p>At this point, we need a loop to read the user input, apply the provided movement (left, right, up, down) and check the game state for game end.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>game_loop</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># create a new game </span>
</span></span><span style=display:flex><span>    board <span style=color:#f92672>=</span> new_game()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># draw board on screen</span>
</span></span><span style=display:flex><span>        draw(board)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># get user input </span>
</span></span><span style=display:flex><span>        dir <span style=color:#f92672>=</span> get_user_input()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># update game board</span>
</span></span><span style=display:flex><span>        board <span style=color:#f92672>=</span> move(board, dir)
</span></span><span style=display:flex><span>        fill_random_cell(board)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># check game state</span>
</span></span><span style=display:flex><span>        is_won, is_lost <span style=color:#f92672>=</span> is_game_won(board), is_game_lost(board)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_won:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;You Won!&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> is_lost:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#39;You Lost!)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span></code></pre></div><p>and that is all :).</p></div></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body>